<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <base href="/">

    <title>c1uster</title>

    <!-- CSS -->
    <link rel="stylesheet" href="libs/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css"> <!-- custom styles -->

    <!-- JS -->
    <script src="libs/angular/angular.min.js"></script>
    <script src="libs/angular-route/angular-route.min.js"></script>

    <!-- ANGULAR CUSTOM -->
    <script src="js/controllers/MainCtrl.js"></script>
    <script src="js/controllers/NerdCtrl.js"></script>
    <script src="js/services/NerdService.js"></script>
    <script src="js/controllers/GeekCtrl.js"></script>
    <script src="js/services/GeekService.js"></script>
    <script src="js/appRoutes.js"></script>
    <script src="js/app.js"></script>
    <script src="js/raphael-min.js"></script>
</head>

<body ng-app="customerApp" ng-controller="customerController">

    <!-- Navigation -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">c1uster</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <li><a href="#filterModal" data-toggle="modal">Filters</a></li>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Content -->
    <div class="container">

        <div class="row">
            <div class="col-lg-12 text-center">
                <h1></h1>
                <div id="canvas"> </div>
            </div>
        </div>
        <!-- /.row -->

    </div>
    <!-- /.container -->

    <!-- Page Pop-Ups -->
    <div class="modal fade" id="filterModal" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content modal-custom">
          <form class="form-horizontal" role="form">
            <div class="modal-header">
              <h4>Filter Clusters</h4>
            </div>
            <div class="modal-body">
              <p>Select from the following filters below</p>
            </div>
            <div class="form-group">
                <label class="checkbox-inline">
                    <input type="checkbox" name="customerInfo" ng-model="customerData.customerInfo.age"> Age
                </label>
                <label class="checkbox-inline">
                    <input type="checkbox" name="customerInfo" ng-model="customerData.customerInfo.income"> Income
                </label>
                <label class="checkbox-inline">
                    <input type="checkbox" name="customerInfo" ng-model="customerData.customerInfo.gender"> Gender
                </label>
                <label class="checkbox-inline">
                    <input type="checkbox" name="customerInfo" ng-model="customerData.customerInfo.avgTimeToPayBill"> Avg Time to Pay Bill
                </label>
                <label class="checkbox-inline">
                    <input type="checkbox" name="customerInfo" ng-model="customerData.customerInfo.degreeStatus"> Degree Status
                </label>
                <label class="checkbox-inline">
                    <input type="checkbox" name="customerInfo" ng-model="customerData.customerInfo.incomeClass"> Income Class
                </label>
                <label class="checkbox-inline">
                    <input type="checkbox" name="customerInfo" ng-model="customerData.customerInfo.professionalStatus"> Professional Status
                </label>
                <label class="checkbox-inline">
                    <input type="checkbox" name="customerInfo" ng-model="customerData.customerInfo.maritalStaus"> Marital Status
                </label>
            </div>
            <pre>
              {{ customerData }}
            </pre>
            <div class="modal-footer">
              <button type="submit" ng-click="submit();" class="btn btn-primary">Submit</button>
              <a class="btn btn-icon" data-dismiss="modal">Close</a>
            </div>
        </div>
      </div>
    </div>

    <!-- jQuery Version 1.11.1 -->
    <script src="js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>

            <script>
      "use stricts";

       $(document).ready(function() {
          drawPlot();
      });

       bucketSize = 0;
       buckets = [];
       

       function Bucket(x, y, color, xStart, xEnd, yEnd) {
        this.x = x;
        this.y = y;
        this.color = color;
        this.xStart = xStart;
        this.xEnd = xEnd;
        this.yEnd = yEnd;
       }

       function barPoint(x, y, lat, longi, color) {
        this.x = x;
        this.y = y;
        this.lat = lat;
        this.longi = longi;
        this.color = color;




       }

      function onHover() {
        var str = "Wow these nodes are " + this.data("color");
        box = paper.rect(this.getBBox().x, this.getBBox().y, 80, 30, 8);
        box.attr({'fill':'#2956b2', 'stroke': '#000066', 'fill-opacity':'0.8', 'stroke-width':'2'});

        box.show();

        var color = this.data("color");

        paper.forEach(function (el) {
          if (el.data("color") != color) {
            el.attr("fill-opacity", 0.22);

          } else {
            console.log("The color is: " + el.data('color'));
            el.attr('stroke',el.data('color'));
            el.attr('stroke-width','5');
            el.attr('stroke-opacity', '1.0');
          }
              
        });

        //paper.text(this.data("originX"), this.data("originY"), str);
                 
      }
            
      function onOut() {
        box.hide();

        paper.forEach(function (el) {

          el.attr("fill-opacity", 1.0);    
          el.attr('stroke-opacity', '0');  
        });
      }

       function drawPlot() {
            // This is the base paper. Width will be 1000 px and Height will be 3000 px
 
            paper = Raphael(document.getElementById('canvas'), '85%','50%');
     

            paper.setViewBox(0,0, 700, 2500, true);
            //var bigCircle = paper.circle(500, 1000, 40);


            var colors = ['#8E44AD', '#446Cb3', '#81cfe0', '#2C3E50', '#22A7F0', '#67809F'];

            for (var i = 1; i <500; i++) {



              var color = Math.round(5 * Math.random());

              var x = Math.round(1200 * Math.random())  + 75;

              var y = Math.round(300 * Math.random()) + 100;

              var circle = paper.circle(x,y, 2).attr({'fill':colors[color], 'stroke-opacity' : '0', 'stroke-width':'15'});
              circle.id = i;
              circle.name = colors[color];
              circle.mouseover(onHover);
              circle.mouseout(onOut);

              circle.data("originX", x);
              circle.data("originY", y);
              circle.data("color", colors[color]);


              var check = true;
              for (var j = 0; j < buckets.length; j++) {
                if (buckets[j].color == colors[color]) {
                  check = false;
                }
              }

              if (check) {
                var k = new Bucket(0,850, colors[color], 0, 0, 1000);
                buckets.push(k);
              }


            }

            bucketSize = buckets.length;

            bucketPlacement(bucketSize);



          
      }

      var notCleared = true;
      var repopulated = false;

      var barPoints = [];

      $(window).scroll(function (event) {

      var scroll = $(window).scrollTop();
      // scroll is pixel offset from top

      // we want scroll to scale to screen height  : less height = more scroll

      scroll = scroll / (($(window).height())/700);

      scroll = scroll / (($(window).width()) / 1300);

      // Do something



        if (scroll > 200 && scroll < 800) {


          //console.log("Bucket size is : " + bucketSize);

          bucketPlacement(bucketSize);

          paper.forEach(function (el) {

          var tString = createBarGraph(el, scroll);

          el.transform(tString);

          //console.log(tString);
          //console.log("800-1100: The x value of the transformed thing is: " + el.attr('x') + " and y is : " + el.attr('y'));
          
          });



        } else if (scroll > 800 && scroll < 1100) {

          bucketPlacement(bucketSize);

          if (notCleared) {
            
            clearData();
            notCleared = false;

            }
            
          }
          

        else if (scroll >= 1100 && scroll < 1400) {
          //bucketPlacement(bucketSize);
          //console.log("We are in the scroll 1100  - 1250");


          paper.forEach(function (el) {

          //console.log("The X coordinate is: " + el.data("barX") +", the Y coordinate is:  " + el.data('barY'));
          //el.attr({'x':el.attr('barX')});
          //el.attr({'y':el.attr('barY')});
          var togetherString = comeTogether(el, scroll);
          //console.log("The x value of the transformed thing is: " + el.attr('x') + " and y is : " + el.attr('y'));

          el.transform(togetherString);
          //console.log("The x value of the transformed thing is: " + el.attr('x') + " and y is : " + el.attr('y'));

          });
        
        } else if (scroll >= 1400 && scroll < 1800) {





        }

        
      });

     

      

      function clearData() {
        barPoints = [];

        paper.forEach(function (el) {
            var mString = updateBarChart(el, 800);
            el.transform(mString);
            //console.log("800-1100: The x value of the transformed thing is: " + el.attr('x') + " and y is : " + el.attr('y'));
            console.log("The bar X is: " + el.data('barX'));
            var k = new barPoint(el.data('barX'), el.data('barY'), 0, 0, el.data('color'));
            barPoints.push(k);
          });
            paper.clear();

            for (var i = 0; i < barPoints.length; i++) {
              console.log(barPoints[i].x);
              console.log(barPoints[i].color);
              var circle = paper.circle(barPoints[i].x,barPoints[i].y, 2).attr({'fill':barPoints[i].color, 'stroke-opacity' : '0'});
              circle.data("x", barPoints[i].x);
              circle.data("y", barPoints[i].y);
              circle.data("color", barPoints[i].color);

              console.log("Just created a new circle!");
            
            }
      }

      function comeTogether(el, scroll) {
        //var bigCircle = paper.circle(500, 1600, 40);
              //console.log("The x value of the transformed thing is: " + el.attr('x') + " and y is : " + el.attr('y'));

              //console.log("The x value is: " + el.attr("x"));


              var originX = el.data("x");
              var originY = el.data("y");


              //console.log("Origins" + originX);


              var scrollPercentage = (scroll-1100) / 300;
              

              var endX = 400;
              var endY = 1300;

              //console.log("Ends" + endY);

              //console.log("ScrollPercentage" + scrollPercentage);

              var currentX = (endX - originX) * scrollPercentage;

              var currentY = (endY - originY) * scrollPercentage;
              // we have a start X and Y --> we need to store this


             


              

              var retString = "t" + currentX +"," + currentY;



              console.log(retString);

              return retString;

            } 
            
      function createBarGraph(el, scroll) {


          //console.log("X is: " + buckets[i].x);
          //console.log(buckets[i].color);
          for (var j = 0; j < buckets.length; j++) {
            if (buckets[j].color == el.name) {
              //console.log("The x value is: " + el.attr("x"));
              var originX = el.data("originX");
              var originY = el.data("originY");

              //console.log("Origins" + originX);


              var scrollPercentage = (scroll-200) / 600;
              

              var endX = buckets[j].x;
              var endY = buckets[j].yEnd;

              //console.log("Ends" + endY);

              //console.log("ScrollPercentage" + scrollPercentage);

              var currentX = (endX - originX) * scrollPercentage;

              var currentY = (endY - originY) * scrollPercentage;
              // we have a start X and Y --> we need to store this


              buckets[j]["x"] += 10;
             


              if (currentX < buckets[j].xStart) {


              var retString = "T" + currentX +"," + currentY;



              if (buckets[j].x >= buckets[j].xEnd) {
                buckets[j].x = buckets[j].xStart;
                buckets[j].yEnd -= 10;

              }

              return retString;

            } else {
              return "";
            }
            }
          }
        




      }


      function updateBarChart(el, scroll) {


          //console.log("X is: " + buckets[i].x);
          //console.log(buckets[i].color);
          for (var j = 0; j < buckets.length; j++) {
            if (buckets[j].color == el.name) {
              //console.log("The x value is: " + el.attr("x"));
              var originX = el.data("originX");
              var originY = el.data("originY");

              //console.log("Origins" + originX);


              var scrollPercentage = (scroll-200) / 600;
              

              var endX = buckets[j].x;
              var endY = buckets[j].yEnd;

              //console.log("Ends" + endY);

              //console.log("ScrollPercentage" + scrollPercentage);

              var currentX = (endX - originX) * scrollPercentage;

              var currentY = (endY - originY) * scrollPercentage;
              // we have a start X and Y --> we need to store this

              el.data("barX", endX);
              el.data("barY", endY);

              console.log("BAR X IS : " + el.data("barX"));


              buckets[j]["x"] += 10;
             


              if (currentX < buckets[j].xStart) {


              var retString = "T" + currentX +"," + currentY;



              if (buckets[j].x >= buckets[j].xEnd) {
                buckets[j].x = buckets[j].xStart;
                buckets[j].yEnd -= 10;

              }

              return retString;

            } else {
              return "";
            }
            }
          }
        




      }
      function bucketPlacement(numBuckets) {


        var bucketLength = (700 / numBuckets);

        bucketLength = bucketLength - 10;

        //console.log("Bucket length is : " + bucketLength);

        var startOfNewBucket = 10;

        var padding = 10;

        for (var i = 0; i < numBuckets; i++) {

          // start and end point of path

          // y is constant
          // x is variable based on both padding & size of bucket

          var endOfBucket = startOfNewBucket+bucketLength;

          //var pathName = "M" + startOfNewBucket + ",850 L" + endOfBucket + ", 850";

          //var bucketBase = paper.path(pathName);

          buckets[i].x = startOfNewBucket;
          buckets[i].xStart = startOfNewBucket;
          buckets[i].xEnd = startOfNewBucket + bucketLength;
          buckets[i].yEnd = 1000;
          startOfNewBucket += (bucketLength + padding);

        }



      }




       </script>

</body>

</html>
